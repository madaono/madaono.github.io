---
layout: post
title: HTTP协议梳理
description: let's make a deal
category: coding
---

<h2>HTTP协议梳理</h2>
想起来当时在大学学习TCP/IP的时候，那本教科书那么厚，看见封面就本能的犯恶心了，但是为了考试，只能3次握手4次挥手地背着，直到后来我看了一本书叫做《图解HTTP》(日 上野宣)，不得不吐槽下，看了许多前端书，还是日本人写的最有意思而且不乏深度。科技本身是很美丽的，但是承载科技的书确大多繁琐乏味，不知磨灭多少热爱科学的社会主义接班人。  
在了解HTTP协议之前，需要大概了解TCP/IP协议族。
<h3>TCP/IP</h3>
一张图解释：  
<img src="http://i1.piimg.com/4851/c9c8cd893b1b457e.png">
TCP的三次握手：  
<img src="http://i2.buimg.com/4851/e58db4e72f4e46d2.png">
整体的网路流程：  
<img src="http://i2.buimg.com/4851/51cbd9f4bbb4a69a.png">
<h3>HTTP协议的主要特点</h3>

*  支持客户/服务器模式。
  
*  简单快速：客户向服务器请求服务时，只需传送请求方法和路径。请求方法常用的有GET、HEAD、POST。每种方法规定了客户与服务器联系的类型不同。由于HTTP协议简单，使得HTTP服务器的程序规模小，因而通信速度很快。
  
*  灵活：HTTP允许传输任意类型的数据对象。正在传输的类型由Content-Type加以标记。

*  无连接：无连接的含义是限制每次连接只处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接。采用这种方式可以节省传输时间。

*  无状态：HTTP协议是无状态协议。无状态是指协议对于事务处理没有记忆能力。缺少状态意味着如果后续处理需要前面的信息，则它必须重传，这样可能导致每次连接传送的数据量增大。另一方面，在服务器不需要先前信息时它的应答就较快。

<h3>告知服务器意图的HTTP方法</h3>
*  GET:获取资源
*  POST:传输实体主体
*  PUT：传输文件（http/1.1的PUT方法自身不带验证机制，所以安全性问题存在）
*  HEAD:获得报文首部（与GET方法一样，只是不返回报文主体部分，多用来确认URI的有效性与资源更新的日期时间）
*  DELETE：删除文件（同样有安全性问题）
*  OPTIONS:询问支持的方法
*  TRACE：追踪路径（易引发跨站追踪攻击，不用）
*  CONNECT：要求用隧道协议连接代理

<h3>HTTP报文内的HTTP信息</h3>
用于 HTTP 协议交互的信息被称为 HTTP 报文。请求端（客户端）的 HTTP 报文叫做请求报文，响应端（服务器端）的叫做响应报文。HTTP 报文本身是由多行（用 CR+LF 作换行符）数据构成的字符串文本。

HTTP 报文大致可分为报文首部和报文主体两块。两者由最初出现的空行（CR+LF）来划分。通常，并不一定要有报文主体。
<img src="http://i2.buimg.com/4851/5f11cec266567c6e.png">  
请求行:包含用于请求的方法，请求 URI 和 HTTP 版本。

状态行:包含表明响应结果的状态码，原因短语和 HTTP 版本。
常见的状态码：  
<img src="http://i2.buimg.com/4851/3f6770c1c791f275.png">

首部字段:包含表示请求和响应的各种条件和属性的各类首部。一般有 4 种首部，分别是：通用首部、请求首部、响应首部和实体首部。

其他:可能包含 HTTP 的 RFC 里未定义的首部（Cookie 等）。


<h3>HTTP首部</h3>
<h4>HTTP报文首部</h4>
HTTP 请求报文 : 在请求中，HTTP 报文由方法、URI、HTTP 版本、HTTP 首部字段等部分构成。
HTTP 响应报文 : 在响应中，HTTP 报文由 HTTP 版本、状态码（数字和原因短语）、HTTP 首部字段 3 部分构成。

<h4>HTTP首部字段</h4>
HTTP 首部字段是构成 HTTP 报文的要素之一。在客户端与服务器之间以 HTTP 协议进行通信的过程中，无论是请求还是响应都会使用首部字段，它能起到传递额外重要信息的作用。

使用首部字段是为了给浏览器和服务器提供报文主体大小、所使用的语言、认证信息等内容。
<h5>HTTP 首部字段结构</h5>

HTTP 首部字段是由首部字段名和字段值构成的，中间用冒号“:” 分隔。

首部字段名: 字段值
例如，在 HTTP 首部中以 Content-Type 这个字段来表示报文主体的 对象类型。

Content-Type: text/html
就以上述示例来看，首部字段名为 Content-Type，字符串 text/html 是字段值。

另外，字段值对应单个 HTTP 首部字段可以有多个值，如下所示。

Keep-Alive: timeout=15, max=100
若 HTTP 首部字段重复了会如何

当 HTTP 报文首部中出现了两个或两个以上具有相同首部字段名时会怎么样？这种情况在规范内尚未明确，根据浏览器内部处理逻辑的不同，结果可能并不一致。有些浏览器会优先处理第一次出现的首部字段，而有些则会优先处理最后出现的首部字段。
<h5>4种HTTP首部字段类型</h5>
* 通用首部字段（General Header Fields）

请求报文和响应报文两方都会使用的首部。

* 请求首部字段（Request Header Fields）

从客户端向服务器端发送请求报文时使用的首部。补充了请求的附加内容、客户端信息、响应内容相关优先级等信息。

* 响应首部字段（Response Header Fields）

从服务器端向客户端返回响应报文时使用的首部。补充了响应的附加内容，也会要求客户端附加额外的内容信息。

* 实体首部字段（Entity Header Fields）

针对请求报文和响应报文的实体部分使用的首部。补充了资源内容更新时间等与实体有关的信息。

这四种首部字段中又有很多方法可以控制缓存，传输数据范围，文本控制等诸多选项，具体的可用时查询。

<h3>HTTP的缺点</h3>
* 通信是明文，内容很容易被窃取；
* 不验证通信方身份，容易被伪装攻击；
* 无法保证报文的完整性；

为了安全性的问题，一般与SSL（Secure Socket Layer,安全套接层）或TLS（Transport Layer Security）结合使用。HTTP结合SSL的就是HTTPS协议。  
HTTP+加密+认证+完整性保护=HTTPS  
其中加密是共享秘钥加密和公开秘钥加密两者并用的混合加密机制，配上CA以解决公开秘钥的替换问题。

<h3>结语</h3>
作为一个前端，了解HTTP协议无疑会指导AJAX以及前后台交互页面的编写，同时通过抓包也可以找到自己前端编写的问题，可以说是每个前端都需要学习的。